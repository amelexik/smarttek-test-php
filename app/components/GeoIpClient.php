<?php

/**
 * Class GeoIpClient
 * User: amelexik
 * Date: 14.11.2021
 */
class GeoIpClient
{
    private string $geoIpDatabaseCompressed = <<<JSON
[{"ISO":"AD","Country":"Andorra","Continent":"EU","Phone":"376"},{"ISO":"AE","Country":"United Arab Emirates","Continent":"AS","Phone":"971"},{"ISO":"AF","Country":"Afghanistan","Continent":"AS","Phone":"93"},{"ISO":"AG","Country":"Antigua and Barbuda","Continent":"NA","Phone":"+1-268"},{"ISO":"AI","Country":"Anguilla","Continent":"NA","Phone":"+1-264"},{"ISO":"AL","Country":"Albania","Continent":"EU","Phone":"355"},{"ISO":"AM","Country":"Armenia","Continent":"AS","Phone":"374"},{"ISO":"AO","Country":"Angola","Continent":"AF","Phone":"244"},{"ISO":"AR","Country":"Argentina","Continent":"SA","Phone":"54"},{"ISO":"AS","Country":"American Samoa","Continent":"OC","Phone":"+1-684"},{"ISO":"AT","Country":"Austria","Continent":"EU","Phone":"43"},{"ISO":"AU","Country":"Australia","Continent":"OC","Phone":"61"},{"ISO":"AW","Country":"Aruba","Continent":"NA","Phone":"297"},{"ISO":"AX","Country":"Aland Islands","Continent":"EU","Phone":"+358-18"},{"ISO":"AZ","Country":"Azerbaijan","Continent":"AS","Phone":"994"},{"ISO":"BA","Country":"Bosnia and Herzegovina","Continent":"EU","Phone":"387"},{"ISO":"BB","Country":"Barbados","Continent":"NA","Phone":"+1-246"},{"ISO":"BD","Country":"Bangladesh","Continent":"AS","Phone":"880"},{"ISO":"BE","Country":"Belgium","Continent":"EU","Phone":"32"},{"ISO":"BF","Country":"Burkina Faso","Continent":"AF","Phone":"226"},{"ISO":"BG","Country":"Bulgaria","Continent":"EU","Phone":"359"},{"ISO":"BH","Country":"Bahrain","Continent":"AS","Phone":"973"},{"ISO":"BI","Country":"Burundi","Continent":"AF","Phone":"257"},{"ISO":"BJ","Country":"Benin","Continent":"AF","Phone":"229"},{"ISO":"BL","Country":"Saint Barthelemy","Continent":"NA","Phone":"590"},{"ISO":"BM","Country":"Bermuda","Continent":"NA","Phone":"+1-441"},{"ISO":"BN","Country":"Brunei","Continent":"AS","Phone":"673"},{"ISO":"BO","Country":"Bolivia","Continent":"SA","Phone":"591"},{"ISO":"BQ","Country":"Bonaire, Saint Eustatius and Saba ","Continent":"NA","Phone":"599"},{"ISO":"BR","Country":"Brazil","Continent":"SA","Phone":"55"},{"ISO":"BS","Country":"Bahamas","Continent":"NA","Phone":"+1-242"},{"ISO":"BT","Country":"Bhutan","Continent":"AS","Phone":"975"},{"ISO":"BW","Country":"Botswana","Continent":"AF","Phone":"267"},{"ISO":"BY","Country":"Belarus","Continent":"EU","Phone":"375"},{"ISO":"BZ","Country":"Belize","Continent":"NA","Phone":"501"},{"ISO":"CA","Country":"Canada","Continent":"NA","Phone":"1"},{"ISO":"CC","Country":"Cocos Islands","Continent":"AS","Phone":"61"},{"ISO":"CD","Country":"Democratic Republic of the Congo","Continent":"AF","Phone":"243"},{"ISO":"CF","Country":"Central African Republic","Continent":"AF","Phone":"236"},{"ISO":"CG","Country":"Republic of the Congo","Continent":"AF","Phone":"242"},{"ISO":"CH","Country":"Switzerland","Continent":"EU","Phone":"41"},{"ISO":"CI","Country":"Ivory Coast","Continent":"AF","Phone":"225"},{"ISO":"CK","Country":"Cook Islands","Continent":"OC","Phone":"682"},{"ISO":"CL","Country":"Chile","Continent":"SA","Phone":"56"},{"ISO":"CM","Country":"Cameroon","Continent":"AF","Phone":"237"},{"ISO":"CN","Country":"China","Continent":"AS","Phone":"86"},{"ISO":"CO","Country":"Colombia","Continent":"SA","Phone":"57"},{"ISO":"CR","Country":"Costa Rica","Continent":"NA","Phone":"506"},{"ISO":"CU","Country":"Cuba","Continent":"NA","Phone":"53"},{"ISO":"CV","Country":"Cape Verde","Continent":"AF","Phone":"238"},{"ISO":"CW","Country":"Curacao","Continent":"NA","Phone":"599"},{"ISO":"CX","Country":"Christmas Island","Continent":"AS","Phone":"61"},{"ISO":"CY","Country":"Cyprus","Continent":"EU","Phone":"357"},{"ISO":"CZ","Country":"Czech Republic","Continent":"EU","Phone":"420"},{"ISO":"DE","Country":"Germany","Continent":"EU","Phone":"49"},{"ISO":"DJ","Country":"Djibouti","Continent":"AF","Phone":"253"},{"ISO":"DK","Country":"Denmark","Continent":"EU","Phone":"45"},{"ISO":"DM","Country":"Dominica","Continent":"NA","Phone":"+1-767"},{"ISO":"DO","Country":"Dominican Republic","Continent":"NA","Phone":"+1-809 and 1-829"},{"ISO":"DZ","Country":"Algeria","Continent":"AF","Phone":"213"},{"ISO":"EC","Country":"Ecuador","Continent":"SA","Phone":"593"},{"ISO":"EE","Country":"Estonia","Continent":"EU","Phone":"372"},{"ISO":"EG","Country":"Egypt","Continent":"AF","Phone":"20"},{"ISO":"EH","Country":"Western Sahara","Continent":"AF","Phone":"212"},{"ISO":"ER","Country":"Eritrea","Continent":"AF","Phone":"291"},{"ISO":"ES","Country":"Spain","Continent":"EU","Phone":"34"},{"ISO":"ET","Country":"Ethiopia","Continent":"AF","Phone":"251"},{"ISO":"FI","Country":"Finland","Continent":"EU","Phone":"358"},{"ISO":"FJ","Country":"Fiji","Continent":"OC","Phone":"679"},{"ISO":"FK","Country":"Falkland Islands","Continent":"SA","Phone":"500"},{"ISO":"FM","Country":"Micronesia","Continent":"OC","Phone":"691"},{"ISO":"FO","Country":"Faroe Islands","Continent":"EU","Phone":"298"},{"ISO":"FR","Country":"France","Continent":"EU","Phone":"33"},{"ISO":"GA","Country":"Gabon","Continent":"AF","Phone":"241"},{"ISO":"GB","Country":"United Kingdom","Continent":"EU","Phone":"44"},{"ISO":"GD","Country":"Grenada","Continent":"NA","Phone":"+1-473"},{"ISO":"GE","Country":"Georgia","Continent":"AS","Phone":"995"},{"ISO":"GF","Country":"French Guiana","Continent":"SA","Phone":"594"},{"ISO":"GG","Country":"Guernsey","Continent":"EU","Phone":"+44-1481"},{"ISO":"GH","Country":"Ghana","Continent":"AF","Phone":"233"},{"ISO":"GI","Country":"Gibraltar","Continent":"EU","Phone":"350"},{"ISO":"GL","Country":"Greenland","Continent":"NA","Phone":"299"},{"ISO":"GM","Country":"Gambia","Continent":"AF","Phone":"220"},{"ISO":"GN","Country":"Guinea","Continent":"AF","Phone":"224"},{"ISO":"GP","Country":"Guadeloupe","Continent":"NA","Phone":"590"},{"ISO":"GQ","Country":"Equatorial Guinea","Continent":"AF","Phone":"240"},{"ISO":"GR","Country":"Greece","Continent":"EU","Phone":"30"},{"ISO":"GT","Country":"Guatemala","Continent":"NA","Phone":"502"},{"ISO":"GU","Country":"Guam","Continent":"OC","Phone":"+1-671"},{"ISO":"GW","Country":"Guinea-Bissau","Continent":"AF","Phone":"245"},{"ISO":"GY","Country":"Guyana","Continent":"SA","Phone":"592"},{"ISO":"HK","Country":"Hong Kong","Continent":"AS","Phone":"852"},{"ISO":"HN","Country":"Honduras","Continent":"NA","Phone":"504"},{"ISO":"HR","Country":"Croatia","Continent":"EU","Phone":"385"},{"ISO":"HT","Country":"Haiti","Continent":"NA","Phone":"509"},{"ISO":"HU","Country":"Hungary","Continent":"EU","Phone":"36"},{"ISO":"ID","Country":"Indonesia","Continent":"AS","Phone":"62"},{"ISO":"IE","Country":"Ireland","Continent":"EU","Phone":"353"},{"ISO":"IL","Country":"Israel","Continent":"AS","Phone":"972"},{"ISO":"IM","Country":"Isle of Man","Continent":"EU","Phone":"+44-1624"},{"ISO":"IN","Country":"India","Continent":"AS","Phone":"91"},{"ISO":"IO","Country":"British Indian Ocean Territory","Continent":"AS","Phone":"246"},{"ISO":"IQ","Country":"Iraq","Continent":"AS","Phone":"964"},{"ISO":"IR","Country":"Iran","Continent":"AS","Phone":"98"},{"ISO":"IS","Country":"Iceland","Continent":"EU","Phone":"354"},{"ISO":"IT","Country":"Italy","Continent":"EU","Phone":"39"},{"ISO":"JE","Country":"Jersey","Continent":"EU","Phone":"+44-1534"},{"ISO":"JM","Country":"Jamaica","Continent":"NA","Phone":"+1-876"},{"ISO":"JO","Country":"Jordan","Continent":"AS","Phone":"962"},{"ISO":"JP","Country":"Japan","Continent":"AS","Phone":"81"},{"ISO":"KE","Country":"Kenya","Continent":"AF","Phone":"254"},{"ISO":"KG","Country":"Kyrgyzstan","Continent":"AS","Phone":"996"},{"ISO":"KH","Country":"Cambodia","Continent":"AS","Phone":"855"},{"ISO":"KI","Country":"Kiribati","Continent":"OC","Phone":"686"},{"ISO":"KM","Country":"Comoros","Continent":"AF","Phone":"269"},{"ISO":"KN","Country":"Saint Kitts and Nevis","Continent":"NA","Phone":"+1-869"},{"ISO":"KP","Country":"North Korea","Continent":"AS","Phone":"850"},{"ISO":"KR","Country":"South Korea","Continent":"AS","Phone":"82"},{"ISO":"KW","Country":"Kuwait","Continent":"AS","Phone":"965"},{"ISO":"KY","Country":"Cayman Islands","Continent":"NA","Phone":"+1-345"},{"ISO":"KZ","Country":"Kazakhstan","Continent":"AS","Phone":"7"},{"ISO":"LA","Country":"Laos","Continent":"AS","Phone":"856"},{"ISO":"LB","Country":"Lebanon","Continent":"AS","Phone":"961"},{"ISO":"LC","Country":"Saint Lucia","Continent":"NA","Phone":"+1-758"},{"ISO":"LI","Country":"Liechtenstein","Continent":"EU","Phone":"423"},{"ISO":"LK","Country":"Sri Lanka","Continent":"AS","Phone":"94"},{"ISO":"LR","Country":"Liberia","Continent":"AF","Phone":"231"},{"ISO":"LS","Country":"Lesotho","Continent":"AF","Phone":"266"},{"ISO":"LT","Country":"Lithuania","Continent":"EU","Phone":"370"},{"ISO":"LU","Country":"Luxembourg","Continent":"EU","Phone":"352"},{"ISO":"LV","Country":"Latvia","Continent":"EU","Phone":"371"},{"ISO":"LY","Country":"Libya","Continent":"AF","Phone":"218"},{"ISO":"MA","Country":"Morocco","Continent":"AF","Phone":"212"},{"ISO":"MC","Country":"Monaco","Continent":"EU","Phone":"377"},{"ISO":"MD","Country":"Moldova","Continent":"EU","Phone":"373"},{"ISO":"ME","Country":"Montenegro","Continent":"EU","Phone":"382"},{"ISO":"MF","Country":"Saint Martin","Continent":"NA","Phone":"590"},{"ISO":"MG","Country":"Madagascar","Continent":"AF","Phone":"261"},{"ISO":"MH","Country":"Marshall Islands","Continent":"OC","Phone":"692"},{"ISO":"MK","Country":"Macedonia","Continent":"EU","Phone":"389"},{"ISO":"ML","Country":"Mali","Continent":"AF","Phone":"223"},{"ISO":"MM","Country":"Myanmar","Continent":"AS","Phone":"95"},{"ISO":"MN","Country":"Mongolia","Continent":"AS","Phone":"976"},{"ISO":"MO","Country":"Macao","Continent":"AS","Phone":"853"},{"ISO":"MP","Country":"Northern Mariana Islands","Continent":"OC","Phone":"+1-670"},{"ISO":"MQ","Country":"Martinique","Continent":"NA","Phone":"596"},{"ISO":"MR","Country":"Mauritania","Continent":"AF","Phone":"222"},{"ISO":"MS","Country":"Montserrat","Continent":"NA","Phone":"+1-664"},{"ISO":"MT","Country":"Malta","Continent":"EU","Phone":"356"},{"ISO":"MU","Country":"Mauritius","Continent":"AF","Phone":"230"},{"ISO":"MV","Country":"Maldives","Continent":"AS","Phone":"960"},{"ISO":"MW","Country":"Malawi","Continent":"AF","Phone":"265"},{"ISO":"MX","Country":"Mexico","Continent":"NA","Phone":"52"},{"ISO":"MY","Country":"Malaysia","Continent":"AS","Phone":"60"},{"ISO":"MZ","Country":"Mozambique","Continent":"AF","Phone":"258"},{"ISO":"NA","Country":"Namibia","Continent":"AF","Phone":"264"},{"ISO":"NC","Country":"New Caledonia","Continent":"OC","Phone":"687"},{"ISO":"NE","Country":"Niger","Continent":"AF","Phone":"227"},{"ISO":"NF","Country":"Norfolk Island","Continent":"OC","Phone":"672"},{"ISO":"NG","Country":"Nigeria","Continent":"AF","Phone":"234"},{"ISO":"NI","Country":"Nicaragua","Continent":"NA","Phone":"505"},{"ISO":"NL","Country":"Netherlands","Continent":"EU","Phone":"31"},{"ISO":"NO","Country":"Norway","Continent":"EU","Phone":"47"},{"ISO":"NP","Country":"Nepal","Continent":"AS","Phone":"977"},{"ISO":"NR","Country":"Nauru","Continent":"OC","Phone":"674"},{"ISO":"NU","Country":"Niue","Continent":"OC","Phone":"683"},{"ISO":"NZ","Country":"New Zealand","Continent":"OC","Phone":"64"},{"ISO":"OM","Country":"Oman","Continent":"AS","Phone":"968"},{"ISO":"PA","Country":"Panama","Continent":"NA","Phone":"507"},{"ISO":"PE","Country":"Peru","Continent":"SA","Phone":"51"},{"ISO":"PF","Country":"French Polynesia","Continent":"OC","Phone":"689"},{"ISO":"PG","Country":"Papua New Guinea","Continent":"OC","Phone":"675"},{"ISO":"PH","Country":"Philippines","Continent":"AS","Phone":"63"},{"ISO":"PK","Country":"Pakistan","Continent":"AS","Phone":"92"},{"ISO":"PL","Country":"Poland","Continent":"EU","Phone":"48"},{"ISO":"PM","Country":"Saint Pierre and Miquelon","Continent":"NA","Phone":"508"},{"ISO":"PN","Country":"Pitcairn","Continent":"OC","Phone":"870"},{"ISO":"PR","Country":"Puerto Rico","Continent":"NA","Phone":"+1-787 and 1-939"},{"ISO":"PS","Country":"Palestinian Territory","Continent":"AS","Phone":"970"},{"ISO":"PT","Country":"Portugal","Continent":"EU","Phone":"351"},{"ISO":"PW","Country":"Palau","Continent":"OC","Phone":"680"},{"ISO":"PY","Country":"Paraguay","Continent":"SA","Phone":"595"},{"ISO":"QA","Country":"Qatar","Continent":"AS","Phone":"974"},{"ISO":"RE","Country":"Reunion","Continent":"AF","Phone":"262"},{"ISO":"RO","Country":"Romania","Continent":"EU","Phone":"40"},{"ISO":"RS","Country":"Serbia","Continent":"EU","Phone":"381"},{"ISO":"RU","Country":"Russia","Continent":"EU","Phone":"7"},{"ISO":"RW","Country":"Rwanda","Continent":"AF","Phone":"250"},{"ISO":"SA","Country":"Saudi Arabia","Continent":"AS","Phone":"966"},{"ISO":"SB","Country":"Solomon Islands","Continent":"OC","Phone":"677"},{"ISO":"SC","Country":"Seychelles","Continent":"AF","Phone":"248"},{"ISO":"SD","Country":"Sudan","Continent":"AF","Phone":"249"},{"ISO":"SS","Country":"South Sudan","Continent":"AF","Phone":"211"},{"ISO":"SE","Country":"Sweden","Continent":"EU","Phone":"46"},{"ISO":"SG","Country":"Singapore","Continent":"AS","Phone":"65"},{"ISO":"SH","Country":"Saint Helena","Continent":"AF","Phone":"290"},{"ISO":"SI","Country":"Slovenia","Continent":"EU","Phone":"386"},{"ISO":"SJ","Country":"Svalbard and Jan Mayen","Continent":"EU","Phone":"47"},{"ISO":"SK","Country":"Slovakia","Continent":"EU","Phone":"421"},{"ISO":"SL","Country":"Sierra Leone","Continent":"AF","Phone":"232"},{"ISO":"SM","Country":"San Marino","Continent":"EU","Phone":"378"},{"ISO":"SN","Country":"Senegal","Continent":"AF","Phone":"221"},{"ISO":"SO","Country":"Somalia","Continent":"AF","Phone":"252"},{"ISO":"SR","Country":"Suriname","Continent":"SA","Phone":"597"},{"ISO":"ST","Country":"Sao Tome and Principe","Continent":"AF","Phone":"239"},{"ISO":"SV","Country":"El Salvador","Continent":"NA","Phone":"503"},{"ISO":"SX","Country":"Sint Maarten","Continent":"NA","Phone":"599"},{"ISO":"SY","Country":"Syria","Continent":"AS","Phone":"963"},{"ISO":"SZ","Country":"Swaziland","Continent":"AF","Phone":"268"},{"ISO":"TC","Country":"Turks and Caicos Islands","Continent":"NA","Phone":"+1-649"},{"ISO":"TD","Country":"Chad","Continent":"AF","Phone":"235"},{"ISO":"TG","Country":"Togo","Continent":"AF","Phone":"228"},{"ISO":"TH","Country":"Thailand","Continent":"AS","Phone":"66"},{"ISO":"TJ","Country":"Tajikistan","Continent":"AS","Phone":"992"},{"ISO":"TK","Country":"Tokelau","Continent":"OC","Phone":"690"},{"ISO":"TL","Country":"East Timor","Continent":"OC","Phone":"670"},{"ISO":"TM","Country":"Turkmenistan","Continent":"AS","Phone":"993"},{"ISO":"TN","Country":"Tunisia","Continent":"AF","Phone":"216"},{"ISO":"TO","Country":"Tonga","Continent":"OC","Phone":"676"},{"ISO":"TR","Country":"Turkey","Continent":"AS","Phone":"90"},{"ISO":"TT","Country":"Trinidad and Tobago","Continent":"NA","Phone":"+1-868"},{"ISO":"TV","Country":"Tuvalu","Continent":"OC","Phone":"688"},{"ISO":"TW","Country":"Taiwan","Continent":"AS","Phone":"886"},{"ISO":"TZ","Country":"Tanzania","Continent":"AF","Phone":"255"},{"ISO":"UA","Country":"Ukraine","Continent":"EU","Phone":"380"},{"ISO":"UG","Country":"Uganda","Continent":"AF","Phone":"256"},{"ISO":"UM","Country":"United States Minor Outlying Islands","Continent":"OC","Phone":"1"},{"ISO":"US","Country":"United States","Continent":"NA","Phone":"1"},{"ISO":"UY","Country":"Uruguay","Continent":"SA","Phone":"598"},{"ISO":"UZ","Country":"Uzbekistan","Continent":"AS","Phone":"998"},{"ISO":"VA","Country":"Vatican","Continent":"EU","Phone":"379"},{"ISO":"VC","Country":"Saint Vincent and the Grenadines","Continent":"NA","Phone":"+1-784"},{"ISO":"VE","Country":"Venezuela","Continent":"SA","Phone":"58"},{"ISO":"VG","Country":"British Virgin Islands","Continent":"NA","Phone":"+1-284"},{"ISO":"VI","Country":"U.S. Virgin Islands","Continent":"NA","Phone":"+1-340"},{"ISO":"VN","Country":"Vietnam","Continent":"AS","Phone":"84"},{"ISO":"VU","Country":"Vanuatu","Continent":"OC","Phone":"678"},{"ISO":"WF","Country":"Wallis and Futuna","Continent":"OC","Phone":"681"},{"ISO":"WS","Country":"Samoa","Continent":"OC","Phone":"685"},{"ISO":"YE","Country":"Yemen","Continent":"AS","Phone":"967"},{"ISO":"YT","Country":"Mayotte","Continent":"AF","Phone":"262"},{"ISO":"ZA","Country":"South Africa","Continent":"AF","Phone":"27"},{"ISO":"ZM","Country":"Zambia","Continent":"AF","Phone":"260"},{"ISO":"ZW","Country":"Zimbabwe","Continent":"AF","Phone":"263"},{"ISO":"CS","Country":"Serbia and Montenegro","Continent":"EU","Phone":"381"},{"ISO":"AN","Country":"Netherlands Antilles","Continent":"NA","Phone":"599"}]
JSON;

    /**
     * @var mixed
     */
    private $database;

    public function __construct()
    {
        $this->database = json_decode($this->geoIpDatabaseCompressed,true);
    }

    /**
     * @param $phoneNumber
     * @return array|null
     */
    public function getCountryByPhone($phoneNumber): ?array
    {
        if (!$this->database) {
            return null;
        }

        foreach ($this->database as $country) {
            if ($country['Phone'] == substr($phoneNumber, 0, strlen($country['Phone']))) {
                return $country;
            }
        }

        return null;
    }
}

